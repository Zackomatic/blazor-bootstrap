@inherits BootstrapContainerBase

<div @attributes="@AdditionalAttributes" class="@Classes" id="@Id">@ChildContent</div>

@code {
    private bool _active;
    private int _id = GetNextId();

    [Parameter]
    public string Id { get; set; }

    [CascadingParameter(Name = TabContainer.TabContainerParameterName)]
    public TabContainer TabContainer { get; set; }

    [Parameter]
    public string Title { get; set; }

    public RenderFragment TabItem => @<TabItem Active="_active" LinkClicked="MakeActive">@Title</TabItem>;

    protected override string DefaultClass
    {
        get
        {
            var classBuilder = new ClassNameBuilder("tab-pane");

            if(_active)
            {
                classBuilder.AddClassName("active");
            }

            return classBuilder.GetClassNames();
        }
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        if (TabContainer == null)
            throw new ArgumentNullException(nameof(TabContainer), $"{nameof(TabPane)} must be rendered inside of a {typeof(TabContainer)}");

        if(string.IsNullOrWhiteSpace(Id))
        {
            Id = $"BBBS_TabPane__{_id}";
        }

        TabContainer.RegisterTab(this);
    }

    internal void Show()
    {
        if (_active)
            return;

        _active = true;
    }

    internal void Hide()
    {
        if (_active == false)
            return;

        _active = false;
        StateHasChanged();
    }

    public async Task MakeActive()
    {
        if (_active)
            return;

        await TabContainer.SetActiveTabAsync(this);
    }

    private static int _nextId;
    private static int GetNextId()
    {
        if (_nextId == int.MaxValue)
            return _nextId = int.MinValue;

        return _nextId++;
    }
}
