@inherits TestBase<TabContainer>

@code {
    private const string TabId1 = "tab_one";
    private const string TabId2 = "tab_two";
    private const string TabId3 = "tab_three";
    

    [Fact]
    public void PanesIsSet_RendersTabContentWithPanesChildContent()
    {
        var cut = RenderComponent(
            @<TabContainer>
                <Panes>
                    <TabPane>Pane 1</TabPane>
                    <TabPane>Pane 2</TabPane>
                </Panes>
            </TabContainer>);

        var content = cut.Find("div.tab-content");
    }

    [Fact]
    public void ActiveTabIdIsNotSet_FirstPaneIsSetToActive()
    {
        var cut = RenderComponent(
            @<TabContainer>
                <Panes>
                    <TabPane>Pane 1</TabPane>
                    <TabPane>Pane 2</TabPane>
                </Panes>
            </TabContainer>);

        AssertTabPane.IsActive(cut, ".tab-content .tab-pane:first-child");
        AssertTabPane.IsNotActive(cut, ".tab-content .tab-pane:nth-child(2)");
    }

    [Theory]
    [InlineData(TabId1)]
    [InlineData(TabId2)]
    [InlineData(TabId3)]
    public void ActiveTabIdIsSet_TabPaneWithActiveIsSetToActiveOnInitialRender(string activeTabId)
    {
        var cut = RenderComponent(
            @<TabContainer ActiveTabId="@activeTabId">
                <Panes>
                    <TabPane Id="@TabId1">Pane 1</TabPane>
                    <TabPane Id="@TabId2">Pane 2</TabPane>
                    <TabPane Id="@TabId3">Pane 3</TabPane>
                </Panes>
            </TabContainer>);

        AssertTabPane.IsActive(cut, $".tab-content .tab-pane#{activeTabId}");

        foreach(var tabPane in cut.FindAll($".tab-content .tab-pane:not(#{activeTabId})"))
        {
            AssertTabPane.IsNotActive(tabPane);
        }
    }

    [Theory]
    [InlineData(TabId1, TabId2)]
    [InlineData(TabId1, TabId3)]
    [InlineData(TabId2, TabId1)]
    public void ActiveTabIdIsUpdated_TabWithMatchingIdIsMadeActive(string initialActiveTab,
        string updatedActiveTab)
    {
        var cut = RenderComponent(
            @<TabContainer ActiveTabId="@initialActiveTab">
                <Panes>
                    <TabPane Id="@TabId1">Pane 1</TabPane>
                    <TabPane Id="@TabId2">Pane 2</TabPane>
                    <TabPane Id="@TabId3">Pane 3</TabPane>
                </Panes>
            </TabContainer>);

        cut.SetParametersAndRender(builder => builder.Add(x => x.ActiveTabId, updatedActiveTab));

        AssertTabPane.IsActive(cut, $".tab-content .tab-pane#{updatedActiveTab}");

        foreach (var tabPane in cut.FindAll($".tab-content .tab-pane:not(#{updatedActiveTab})"))
        {
            AssertTabPane.IsNotActive(tabPane);
        }
    }

    [Fact]
    public void TabsFragmentIsNotSet_RendersTabItemsForChildPanes()
    {
        const string Title1 = "Tab Title 1";
        const string Title2 = "Tab Title 2";
        const string Title3 = "Tab Title 3";
        var cut = RenderComponent(
            @<TabContainer>
                <Panes>
                    <TabPane Id="@TabId1" Title="@Title1">Pane 1</TabPane>
                    <TabPane Id="@TabId2" Title="@Title2">Pane 2</TabPane>
                    <TabPane Id="@TabId3" Title="@Title3">Pane 3</TabPane>
                </Panes>
            </TabContainer>);

        cut.Render();

        var tabItems = cut.FindAll("li");
        Assert.Equal(3, tabItems.Count);
        Assert.NotNull(cut.FindComponent<TabList>());
    }
}
